<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TN Election 2026 - Live Results</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #0f6605;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }
    .container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 15px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .party-row {
      display: flex;
      align-items: center;
      margin: 12px 0;
      background: #fafafa;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #ddd;
    }
    .party-row img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      margin-right: 15px;
      object-fit: contain;
      border: 1px solid #ccc;
      background: #fff;
    }
    .party-info {
      flex: 1;
    }
    .party-name {
      font-weight: bold;
      margin-bottom: 6px;
    }
    .bar-container {
      background: #eee;
      border-radius: 6px;
      height: 22px;
      width: 100%;
      overflow: hidden;
      margin-bottom: 6px;
    }
    .bar {
      height: 100%;
      background: linear-gradient(90deg,#1a8b12,#0f6605);
      width: 0;
      transition: width 1.5s ease;
    }
    .stats {
      font-size: 14px;
      color: #444;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #f0f0f0;
    }
    canvas {
      margin-top: 25px;
    }
    @media (max-width: 600px) {
      .party-row { flex-direction: column; align-items: flex-start; }
      .party-row img { margin-bottom: 8px; }
    }
  </style>
</head>
<body>
  <header>TN Election 2026 - Live Results</header>
  <div class="container">
    <h2>Live Party Votes</h2>
    <div id="partyResults"></div>

    <h2>Party-wise Results Table</h2>
    <table id="resultsTable">
      <thead>
        <tr>
          <th>Party</th>
          <th>Votes</th>
          <th>Percentage</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <canvas id="barChart"></canvas>
    <canvas id="pieChart"></canvas>
  </div>

  <script>
    // CSV file (from GitHub repo)
    const csvUrl = "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/data.csv";

    let barChart, pieChart;

    async function fetchData() {
      try {
        const res = await fetch(csvUrl + "?t=" + new Date().getTime());
        if (!res.ok) throw new Error("Failed to load CSV");
        const text = await res.text();

        const rows = text.trim().split("\n");
        const headers = rows[0].split(",");
        const voteIndex = headers.indexOf("Vote");
        if (voteIndex === -1) throw new Error("Vote column not found in CSV");

        const partyVotes = {};
        rows.slice(1).forEach(row => {
          const cols = row.split(",");
          const party = cols[voteIndex].trim();
          if (party) {
            partyVotes[party] = (partyVotes[party] || 0) + 1;
          }
        });

        renderResults(partyVotes);
      } catch (err) {
        console.error("Error fetching data:", err);
        document.getElementById("partyResults").innerHTML = "<p>⚠️ Failed to load results.</p>";
      }
    }

    function renderResults(partyVotes) {
      const totalVotes = Object.values(partyVotes).reduce((a, b) => a + b, 0);

      // Party Logos
      const partyLogos = {
        "DMK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/DMK.jpg",
        "AIADMK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/AIADMK.jpg",
        "TVK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/TVK.jpg",
        "VCK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/VCK.jpg",
        "NTK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/NTK.png",
        "PMK": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/PMK.jpg",
        "INC": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/INC.jpg",
        "BJP": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/BJP.jpg",
        "CPI": "https://raw.githubusercontent.com/darkdhina-1300/tn-election-surveyv1/main/images/CIP.jpeg"
      };

      // Party Rows
      const partyResults = document.getElementById("partyResults");
      partyResults.innerHTML = "";

      Object.entries(partyVotes)
        .sort((a, b) => b[1] - a[1])
        .forEach(([party, votes]) => {
          const percent = ((votes / totalVotes) * 100).toFixed(1);
          const row = document.createElement("div");
          row.className = "party-row";
          row.innerHTML = `
            <img src="${partyLogos[party] || 'https://via.placeholder.com/60'}" alt="${party}">
            <div class="party-info">
              <div class="party-name">${party}</div>
              <div class="bar-container"><div class="bar" style="width:0"></div></div>
              <div class="stats"><span class="votes">0</span> votes • ${percent}%</div>
            </div>
          `;
          partyResults.appendChild(row);

          setTimeout(() => {
            row.querySelector(".bar").style.width = percent + "%";
          }, 100);

          animateCount(row.querySelector(".votes"), votes, 1500);
        });

      // Table
      const tbody = document.querySelector("#resultsTable tbody");
      tbody.innerHTML = "";
      Object.entries(partyVotes).forEach(([party, votes]) => {
        const percent = ((votes / totalVotes) * 100).toFixed(1);
        tbody.innerHTML += `
          <tr>
            <td>${party}</td>
            <td class="count" data-value="${votes}">0</td>
            <td class="count" data-value="${percent}">0%</td>
          </tr>`;
      });
      animateCounts();

      // Charts
      renderCharts(partyVotes);
    }

    function renderCharts(partyVotes) {
      const labels = Object.keys(partyVotes);
      const data = Object.values(partyVotes);
      const colors = [
        "#1a8b12", "#f39c12", "#3498db", "#e74c3c",
        "#9b59b6", "#2ecc71", "#e67e22", "#16a085"
      ];

      if (barChart) barChart.destroy();
      if (pieChart) pieChart.destroy();

      const ctx1 = document.getElementById("barChart").getContext("2d");
      barChart = new Chart(ctx1, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{ label: "Votes", data: data, backgroundColor: colors }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      const ctx2 = document.getElementById("pieChart").getContext("2d");
      pieChart = new Chart(ctx2, {
        type: "pie",
        data: { labels: labels, datasets: [{ data: data, backgroundColor: colors }] },
        options: { responsive: true }
      });
    }

    function animateCount(el, target, duration) {
      let start = 0;
      const step = Math.ceil(target / (duration / 30));
      const counter = setInterval(() => {
        start += step;
        if (start >= target) {
          start = target;
          clearInterval(counter);
        }
        el.textContent = start.toLocaleString();
      }, 30);
    }

    function animateCounts() {
      document.querySelectorAll(".count").forEach(el => {
        const value = parseFloat(el.dataset.value);
        let start = 0;
        const isPercent = el.dataset.value.toString().includes(".");
        const duration = 1000;
        const step = value / (duration / 30);
        const interval = setInterval(() => {
          start += step;
          if (start >= value) {
            el.textContent = isPercent ? value.toFixed(1) + "%" : Math.round(value);
            clearInterval(interval);
          } else {
            el.textContent = isPercent ? start.toFixed(1) + "%" : Math.round(start);
          }
        }, 30);
      });
    }

    fetchData();
    setInterval(fetchData, 5 * 60 * 1000);
  </script>
</body>
</html>
